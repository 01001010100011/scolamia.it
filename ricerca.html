<!DOCTYPE html>
<html lang="it" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ricerca - ScolaMia.it</title>
  <meta name="description" content="Ricerca universale tra articoli, agenda e contatti." />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { accent: "#0c7ff2", paper: "#f4f3ee", ink: "#101010" },
          fontFamily: { display: ["Bebas Neue", "sans-serif"], body: ["IBM Plex Sans", "sans-serif"] },
          boxShadow: { brutal: "4px 4px 0 0 #000" }
        }
      }
    };
  </script>
  <style>
    body { font-family: "IBM Plex Sans", sans-serif; background: #f4f3ee; }
    .headline { font-family: "Bebas Neue", sans-serif; letter-spacing: .04em; }
  </style>
</head>
<body class="text-ink">
  <header class="sticky top-0 z-50 bg-paper border-b-4 border-black">
    <div class="max-w-7xl mx-auto px-4 md:px-8 py-4 flex items-center justify-between gap-4">
      <a href="index.html" class="flex items-center gap-3">
        <div class="border-2 border-black bg-accent p-1.5"><span class="material-symbols-outlined text-white block">school</span></div>
        <div>
          <p class="headline text-3xl leading-none">ScolaMia.it</p>
          <p class="text-xs font-semibold uppercase tracking-wider">Ricerca universale</p>
        </div>
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm font-bold uppercase">
        <a href="archivio.html" class="hover:text-accent">Articoli</a>
        <a href="agenda.html" class="hover:text-accent">Agenda</a>
        <a href="contatti.html" class="hover:text-accent">Contatti</a>
      </nav>
      <a href="admin.html" class="border-2 border-black bg-black text-white px-4 py-2 text-xs font-bold uppercase shadow-brutal">Login Admin</a>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 md:px-8 py-8 space-y-8">
    <section class="border-4 border-black bg-white p-6 shadow-brutal">
      <h1 class="headline text-6xl">Ricerca</h1>
      <p class="mt-2 text-sm">Cerca contemporaneamente tra articoli, eventi in agenda e contatti.</p>
      <form id="searchForm" class="mt-5 flex items-center border-2 border-black bg-paper max-w-xl">
        <span class="material-symbols-outlined px-3">search</span>
        <input id="searchInput" type="search" placeholder="Scrivi qui..." class="w-full border-0 bg-transparent focus:ring-0" />
      </form>
    </section>

    <section>
      <h2 class="headline text-5xl">Articoli</h2>
      <div id="articleResults" class="mt-3 grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </section>

    <section>
      <h2 class="headline text-5xl">Agenda</h2>
      <div id="agendaResults" class="mt-3 grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </section>

    <section>
      <h2 class="headline text-5xl">Contatti</h2>
      <div id="contactResults" class="mt-3 grid md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </section>
  </main>

  <script>
    const STORAGE_KEY = "blogDeScuolaArticles";
    const AGENDA_STORAGE_KEY = "blogDeScuolaAgendaEvents";

    const defaultArticles = [
      { id: "seed-1", title: "Compiti settimanali - Classi seconde", category: "Compiti", excerpt: "Materiali e consegne per matematica, italiano e scienze.", content: "Pubblicazione di esempio.", published: true, createdAt: "2026-02-18T08:00:00.000Z", updatedAt: "2026-02-18T08:00:00.000Z" },
      { id: "seed-2", title: "Open Day: programma completo", category: "Eventi", excerpt: "Orari, laboratori e visite guidate per nuovi iscritti.", content: "Pubblicazione di esempio.", published: true, createdAt: "2026-02-17T08:00:00.000Z", updatedAt: "2026-02-17T08:00:00.000Z" },
      { id: "seed-3", title: "Giornale digitale degli studenti", category: "Progetti", excerpt: "Interviste, rubriche e lavori multimediali a cura della redazione.", content: "Pubblicazione di esempio.", published: true, createdAt: "2026-02-16T08:00:00.000Z", updatedAt: "2026-02-16T08:00:00.000Z" }
    ];

    const defaultEvents = [
      { id: "evt-1", date: "2026-03-03", title: "Consigli di classe", category: "Didattica", description: "Riunione coordinatori e docenti per andamento classi." },
      { id: "evt-2", date: "2026-03-08", title: "Mostra dei progetti artistici", category: "Progetti", description: "Esposizione lavori creativi degli studenti." },
      { id: "evt-3", date: "2026-03-14", title: "Giochi matematici d'istituto", category: "Competizioni", description: "Sfida interna di logica e matematica." }
    ];

    const contacts = [
      { label: "Redazione studenti", value: "redazione.studenti@scolamia-demo.it", href: "mailto:redazione.studenti@scolamia-demo.it" },
      { label: "Supporto tecnico", value: "supporto.tech@scolamia-demo.it", href: "mailto:supporto.tech@scolamia-demo.it" },
      { label: "Segreteria", value: "segreteria@scolamia-demo.it", href: "mailto:segreteria@scolamia-demo.it" },
      { label: "Instagram", value: "@scolamia_demo", href: "https://instagram.com/scolamia_demo" }
    ];

    function getArticles() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return [...defaultArticles];
      try {
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [...defaultArticles];
      } catch {
        return [...defaultArticles];
      }
    }

    function getEvents() {
      const raw = localStorage.getItem(AGENDA_STORAGE_KEY);
      if (!raw) return [...defaultEvents];
      try {
        const parsed = JSON.parse(raw);
        return Array.isArray(parsed) ? parsed : [...defaultEvents];
      } catch {
        return [...defaultEvents];
      }
    }

    function match(text, query) {
      return text.toLowerCase().includes(query.toLowerCase());
    }

    function dateTokens(value) {
      if (!value) return "";
      const date = new Date(value);
      if (Number.isNaN(date.getTime())) return value;
      return `${value} ${date.toLocaleDateString("it-IT")} ${date.toLocaleDateString("it-IT", { day: "2-digit", month: "long", year: "numeric" })}`;
    }

    function render(query = "") {
      const q = query.trim();

      const articleResults = getArticles()
        .filter((item) => item.published)
        .filter((item) => !q || match(`${item.title} ${item.category} ${item.excerpt} ${item.content} ${dateTokens(item.createdAt)} ${dateTokens(item.updatedAt)}`, q));

      const agendaResults = getEvents()
        .filter((item) => !q || match(`${item.title} ${item.category} ${item.description} ${dateTokens(item.date)}`, q));

      const contactResults = contacts
        .filter((item) => !q || match(`${item.label} ${item.value}`, q));

      document.getElementById("articleResults").innerHTML = articleResults.length
        ? articleResults.map((item) => `
            <article class="border-2 border-black bg-white p-4 shadow-brutal">
              ${item.imageDataUrl ? `<div class="mb-3 border-2 border-black aspect-[16/9] overflow-hidden"><img src="${item.imageDataUrl}" alt="Immagine ${item.title}" class="w-full h-full object-cover" /></div>` : ""}
              <p class="text-xs font-bold uppercase text-accent">${item.category}</p>
              <h3 class="mt-2 text-lg font-semibold">${item.title}</h3>
              <p class="mt-2 text-sm">${item.excerpt}</p>
              <a href="article.html?id=${encodeURIComponent(item.id)}" class="inline-block mt-3 text-xs font-bold uppercase underline">Apri</a>
            </article>
          `).join("")
        : '<div class="md:col-span-3 border-2 border-black bg-white p-4">Nessun articolo trovato.</div>';

      document.getElementById("agendaResults").innerHTML = agendaResults.length
        ? agendaResults.map((item) => `
            <article class="border-2 border-black bg-white p-4 shadow-brutal">
              <p class="text-xs font-bold uppercase text-accent">${item.category}</p>
              <h3 class="mt-2 text-lg font-semibold">${item.title}</h3>
              <p class="mt-2 text-sm">${item.description}</p>
              <p class="mt-2 text-[11px] uppercase font-bold text-slate-500">${new Date(item.date).toLocaleDateString("it-IT")}</p>
              <a href="agenda.html" class="inline-block mt-3 text-xs font-bold uppercase underline">Vai agenda</a>
            </article>
          `).join("")
        : '<div class="md:col-span-3 border-2 border-black bg-white p-4">Nessun evento trovato.</div>';

      document.getElementById("contactResults").innerHTML = contactResults.length
        ? contactResults.map((item) => `
            <article class="border-2 border-black bg-white p-4 shadow-brutal">
              <p class="text-xs font-bold uppercase text-accent">${item.label}</p>
              <a href="${item.href}" ${item.href.startsWith("http") ? 'target="_blank" rel="noreferrer"' : ""} class="mt-2 inline-block font-semibold underline">${item.value}</a>
            </article>
          `).join("")
        : '<div class="md:col-span-3 border-2 border-black bg-white p-4">Nessun contatto trovato.</div>';
    }

    const params = new URLSearchParams(window.location.search);
    const initialQuery = params.get("q") || "";
    const searchInput = document.getElementById("searchInput");
    searchInput.value = initialQuery;

    document.getElementById("searchForm").addEventListener("submit", (event) => {
      event.preventDefault();
      const query = searchInput.value.trim();
      const url = query ? `ricerca.html?q=${encodeURIComponent(query)}` : "ricerca.html";
      history.replaceState(null, "", url);
      render(query);
    });

    searchInput.addEventListener("input", () => render(searchInput.value));
    render(initialQuery);
  </script>
</body>
</html>
